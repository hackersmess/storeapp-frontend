<nav class="navbar">
  <div class="navbar-container">
    <!-- Sinistra: back button o logo -->
    <div class="navbar-left">
      @if (breadcrumb.state().showBack) {
        <button class="back-btn" (click)="goBack()" type="button" aria-label="Torna indietro">
          <ng-icon name="lucideChevronLeft" size="22"></ng-icon>
        </button>
        <span class="navbar-page-title">{{ breadcrumb.state().title }}</span>
      } @else {
        <a routerLink="/home" class="navbar-brand">
          <span class="logo">StoreApp</span>
        </a>
      }
    </div>

    <!-- Navigation Links (solo su desktop, solo su rotte root) -->
    @if (currentUser$ | async; as user) {
      @if (!breadcrumb.state().showBack) {
        <div class="navbar-menu">
          <a
            routerLink="/home"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            >Home</a
          >
          <a routerLink="/groups" routerLinkActive="active">Gruppi</a>
        </div>
      }

      <!-- User Menu (sempre visibile) -->
      <div class="navbar-user">
        <button class="user-button" (click)="toggleMenu()">
          <div class="user-avatar">
            @if (user.avatarUrl) {
              <img [src]="user.avatarUrl" [alt]="user.name" />
            } @else {
              <span>{{ user.name.charAt(0).toUpperCase() }}</span>
            }
          </div>
          <span class="user-name">{{ user.name }}</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            class="chevron"
            [class.rotate]="isMenuOpen"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </button>

        @if (isMenuOpen) {
          <div class="dropdown-menu">
            <a routerLink="/profile" class="dropdown-item" (click)="toggleMenu()">
              <ng-icon name="lucideUser" size="20"></ng-icon>
              Profilo
            </a>
            <a routerLink="/settings" class="dropdown-item" (click)="toggleMenu()">
              <ng-icon name="lucideSettings" size="20"></ng-icon>
              Impostazioni
            </a>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item logout" (click)="logout()">
              <ng-icon name="lucideLogOut" size="20"></ng-icon>
              Logout
            </button>
          </div>
        }
      </div>
    } @else {
      <div class="navbar-auth">
        <a routerLink="/login" class="btn-secondary">Accedi</a>
        <a routerLink="/register" class="btn-primary">Registrati</a>
      </div>
    }
  </div>
</nav>

@if (isMenuOpen) {
  <div class="overlay" (click)="toggleMenu()"></div>
}
