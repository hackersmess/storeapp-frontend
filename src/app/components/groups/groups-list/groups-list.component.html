<div class="groups-container">
  <div class="header">
    <h1>I Miei Gruppi</h1>
    <button class="btn-primary" (click)="createGroup()">
      <ng-icon name="lucideCirclePlus" size="20"></ng-icon>
      Crea Nuovo Gruppo
    </button>
  </div>

  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Caricamento gruppi...</p>
    </div>
  }

  @if (error()) {
    <div class="error-message">
      {{ error() }}
      <button (click)="loadGroups()">Riprova</button>
    </div>
  }

  @if (!loading() && !error()) {
    <div class="groups-grid">
      @if (groups().length === 0) {
        <div class="no-groups">
          <ng-icon name="lucideUsers" size="48"></ng-icon>
          <h2>Nessun gruppo trovato</h2>
          <p>Crea il tuo primo gruppo per iniziare a organizzare le vacanze!</p>
        </div>
      }

      @for (group of groups(); track group.id) {
        <div class="group-card" (click)="viewGroup(group.id)">
          <div
            class="group-cover"
            [style.background-image]="group.coverImageUrl ? 'url(' + group.coverImageUrl + ')' : ''"
          >
            <div class="group-overlay">
              <h3>{{ group.name }}</h3>
            </div>
          </div>

          <div class="group-info">
            @if (group.description) {
              <p class="description">{{ group.description }}</p>
            }

            <div class="group-meta">
              <div class="meta-item">
                <ng-icon name="lucideCalendar" size="16"></ng-icon>
                @if (group.vacationStartDate && group.vacationEndDate) {
                  <span>
                    {{ formatDate(group.vacationStartDate) }} -
                    {{ formatDate(group.vacationEndDate) }}
                  </span>
                } @else {
                  <span>Date non specificate</span>
                }
              </div>

              <div class="meta-item">
                <ng-icon name="lucideUsers" size="16"></ng-icon>
                <span
                  >{{ group.memberCount }} {{ group.memberCount === 1 ? 'membro' : 'membri' }}</span
                >
              </div>
            </div>

            <div class="group-creator">
              @if (group.createdBy.avatarUrl) {
                <img [src]="group.createdBy.avatarUrl" [alt]="group.createdBy.name" />
              } @else {
                <div class="avatar-placeholder">
                  {{ group.createdBy.name.charAt(0).toUpperCase() }}
                </div>
              }
              <span>Creato da {{ group.createdBy.name }}</span>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
