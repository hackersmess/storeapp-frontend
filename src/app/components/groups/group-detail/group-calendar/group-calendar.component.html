<div class="calendar-container">
  <div class="calendar-days">
    @for (day of calendarDays(); track day.date.getTime()) {
      <div
        class="calendar-day"
        [class.today]="day.isToday"
        [class.selected]="day.isSelected"
        (click)="onDayClick(day)"
      >
        <div class="day-header">
          <div class="day-info">
            <span class="day-name">{{ day.dayName }}</span>
            <span class="day-number">{{ day.dayNumber }}</span>
          </div>
          <button
            class="add-activity-btn"
            (click)="onCreateActivity(day, $event)"
            type="button"
            title="Aggiungi attività"
          >
            <ng-icon name="lucidePlus" size="14"></ng-icon>
            <span>Aggiungi</span>
          </button>
        </div>

        <div class="day-activities">
          @if (day.activities.length === 0) {
            <div class="no-activities">Nessuna attività</div>
          } @else {
            @for (activity of day.activities; track activity.id) {
              <div class="activity-item">
                <div class="activity-main">
                  <div class="activity-content">
                    <div class="activity-title">{{ activity.title }}</div>
                    <div class="activity-meta">
                      <span class="activity-time">{{ formatTime(activity.start) }}</span>
                      <span class="activity-separator">•</span>
                      <span class="activity-time">{{ formatTime(activity.end) }}</span>
                      @if (activity.locationName) {
                        <span class="activity-separator">•</span>
                        <span class="activity-location">
                          <ng-icon name="lucideMapPin" size="12"></ng-icon>
                          {{ activity.locationName }}
                        </span>
                      }
                    </div>
                  </div>
                </div>
                <div class="activity-actions">
                  <button
                    class="edit-activity-btn"
                    (click)="onActivityClick(activity, $event)"
                    type="button"
                    title="Modifica attività"
                  >
                    <ng-icon name="lucidePencil" size="12"></ng-icon>
                    <span>Modifica</span>
                  </button>
                  <button
                    class="add-expense-btn"
                    (click)="onAddExpense(activity.id, $event)"
                    type="button"
                    title="Aggiungi spesa"
                  >
                    <ng-icon name="lucideDollarSign" size="12"></ng-icon>
                    <span>Spese</span>
                  </button>
                  <button
                    class="delete-activity-btn"
                    (click)="onDeleteActivity(activity.id, $event)"
                    type="button"
                    title="Elimina attività"
                  >
                    <ng-icon name="lucideTrash2" size="12"></ng-icon>
                  </button>
                </div>
              </div>
            }
          }
        </div>
      </div>
    }
  </div>
</div>
